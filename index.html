<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Voice Fun</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header
col-xs-12 col-xs-offset-0 col-sm-8 col-sm-offset-1 col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Voice-Fun</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</div>
<div class="container">
    <div id="recordingslist" class="">

    </div>
</div>
<div class="footer">
    <div class="container">
        <div class="row">
            <div id="push_to_talk" class="btn btn-success
            col-xs-12 col-xs-offset-0 col-sm-8 col-sm-offset-1 col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4">
                Push to Talk</div>
        </div>
    </div>
</div>
<script src="recorderjs/recorder.js"></script>
<script src="jquery-2.1.1.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script>

    jQuery(function($) {
        function __log(e, data) {
            //console.log(e);
            //console.log(data);
        }

        var audio_context;
        var recorder;

        function startUserMedia(stream) {
            var input = audio_context.createMediaStreamSource(stream);
            __log('Media stream created.');

            recorder = new Recorder(input);
            __log('Recorder initialised.');
        }

        function startRecording() {
            recorder && recorder.record();
            __log('Recording...');
        }

        function stopRecording() {
            recorder && recorder.stop();
            __log('Stopped recording.');

            // create WAV download link using audio data blob
            createDownloadLink();

            recorder.clear();
        }

        function createDownloadLink() {
            recorder && recorder.exportWAV(function(blob) {
                var url = URL.createObjectURL(blob);
                $("#recordingslist")
                    .append($("<div>", {class : "row"})
                        .append($("<audio>", {
                            class: "col-xs-12 col-xs-offset-0 col-sm-8 col-sm-offset-1 col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4",
                            src: url,
                            controls: true
                 })));
            });
        }


        $(document).ready(function() {
            try {
                // webkit shim
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
                window.URL = window.URL || window.webkitURL;

                audio_context = new AudioContext;
                __log('Audio context set up.');
                __log('navigator.getUserMedia ' + (navigator.getUserMedia ? 'available.' : 'not present!'));
            } catch (e) {
                alert('No web audio support in this browser!');
            }

            navigator.getUserMedia({audio: true}, startUserMedia, function(e) {
                __log('No live audio input: ' + e);
            });

            var ON = 1;
            var OFF = 0;
            var status = OFF;
            var start = function() {
                status = ON;
                startRecording();
                $("#push_to_talk").removeClass("btn-success");
                $("#push_to_talk").addClass("btn-default");
            };
            var stop = function() {
                status = OFF;
                stopRecording();
                $("#push_to_talk").removeClass("btn-default");
                $("#push_to_talk").addClass("btn-success");
            };
            $("#push_to_talk").click(function(){
                if (status == OFF) { // was off, turn on
                    start();
                } else { // was on ignore.
                    stop();
                }
            });

        });
    });
</script>
</body>
</html>